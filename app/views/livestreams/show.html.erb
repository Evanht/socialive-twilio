
<div class="container" id="title-controls-container" style="background: linear-gradient(-225deg, rgba(255, 255, 255, 0.68) 0%, rgba(255, 255, 255, 1) 80%), url(<%= cl_image_path @livestream.main_picture.path %>);">

  <div id="background-image-title-banner">

  </div>

  <div class="row">
    <div class="col-xs-12">

      <h2 style="color: #000030;", id="livestream-show-page-title"><%= @livestream.user.first_name.capitalize %> <%= @livestream.user.last_name.capitalize %></h2><h4 id="livestream-show-page-title"><%= @livestream.title %></h4>

    </div>
    <div class="col-xs-12">
    <div class="controls">

      <% if current_user == @livestream.user && @livestream.hour_of_stream <= Time.now %>

      <!-- moved this part at the bottom of video chat -->

      <% elsif current_user == @livestream.user  %>
      <em>Refresh this page when your livestream is scheduled to start and a "Start stream" button will appear </em>
      <div id="controls">

        <div id="preview">

          <!-- <div id="local-media"></div> -->

          <button class="btn-primary btn btn-float-left" id="button-preview">Preview My Camera</button>

        </div>
        <div id="room-controls">
          <!-- <p class="instructions">Room Name:</p> -->
          <!-- <input id="room-name" type="text-area" placeholder="Enter a room name" /> -->
          <%#= if current_user == @livestream.user %>
          <button class="btn-primary btn btn-float-left hidden-buttons" id="button-join">Start stream</button>

          <button class="btn-primary btn btn-float-left hidden-buttons" id="button-leave">End stream</button>

        </div>
        <div id="log"></div>
      </div>
      <% elsif current_user.tickets.where(livestream: @livestream).any? %>
      <p id="ticket-bought">Ticket Bought</p>
      <div class="hidden-buttons">
        <div id="controls">

          <div id="preview">

            <div id="local-media"></div>

            <button id="button-preview">Preview My Camera</button>

          </div>
          <div id="room-controls">
            <!-- <p class="instructions">Room Name:</p> -->
            <!-- <input id="room-name" type="text-area" placeholder="Enter a room name" /> -->
            <%#= if current_user == @livestream.user %>
            <button id="button-join">Join Room</button>

            <button id="button-leave">Leave Room</button>

          </div>
          <div id="log"></div>
        </div>
      </div>
      <% elsif (@livestream.tickets_available - @livestream.tickets_sold) > 0 %>
      <%= render 'shared/buy_ticket' %>
      <% else %>
         <p id="tickets-sold-out">Sold out</p>
      <% end %>
      </div>
    </div>
  </div>
</div>


<div class="mid-screen-wrapper">

  <div class="video-wrapper">




      <div class="video-box">
        <%= render 'livestreams/video-section' %>
      </div>


      <div class="chat-box">
        <%= render 'livestreams/chat-section' %>
      </div>

  </div>

  <!-- inserting start/end livestream buttons below -->

<div class="controls player-menu livestream-controls">

  <% if current_user == @livestream.user && @livestream.hour_of_stream <= Time.now %>
  <div id="controls">

    <div id="preview">

      <!-- <div id="local-media"></div> -->

      <button class="btn-primary btn btn-float-left hidden-buttons" id="button-preview">Preview My Camera</button>

    </div>
    <div id="room-controls">
      <!-- <p class="instructions">Room Name:</p> -->
      <!-- <input id="room-name" type="text-area" placeholder="Enter a room name" /> -->
      <%#= if current_user == @livestream.user %>
      <button class="btn-primary btn btn-float-left" id="button-join">Start stream</button>

      <button class="btn-primary btn btn-float-left" id="button-leave">End stream</button>

    </div>
    <div id="log">
    </div>
  </div>
  <% end %>

</div>

  <!-- inserting start/end livestream buttons above -->

</div>





<div class="container">
  <div class="row">
    <div class="col-xs-12 col-sm-10 col-sm-offset-1 col-md-10 col-md-offset-1">
      <% if current_user == @livestream.user %>
      <div class="pre-livestream-title">
        <h4>Questions asked by ticket holders before the livestream</h4>
      </div>
      <!-- <div id="inquiry-input"> -->
      <%#= simple_form_for [@livestream, @question] do |f| %>
      <%#= f.input :inquiry, label: false %>
      <%#= f.button :submit, 'Ask', class: 'btn btn-primary' %>
      <%# end %>
      <!-- </div> -->
      <div class="pre-livestream-questions-container">
        <table id="pre-livestream-questions">
          <% if @livestream.questions.any? %>
          <% @livestream.questions.each do |question| %>
          <tr>
            <th><%= question.inquiry %></th>
            <td><%= question.user.first_name %></td>
          </tr>
          <% end %>
          <% end %>
        </table>
      </div>
      <% end %>
    </div>
  </div>

  <div class="row">
    <!-- this col is the profile -->
    <div class="col-xs-12 col-md-8">
      <div class="profile-wrapper margin-bottom-20">
        <!-- now we nest another bootstrap grid so that we can have a responsive profile layout -->
        <div class="row">
          <!-- Below is the avatar div -->
          <div class="col-xs-12 col-sm-4">
            <div>
              <% if @livestream.user.profilepic != nil %>
              <%= cl_image_tag(@livestream.user.profilepic.path, class: "profile-avatar-circle", crop: :fill) %>
              <% else %>
              <% end %>
            </div>
          </div>
          <!-- Below is the about user div-->
          <div class="col-xs-12 col-sm-8">
            <h3><%= @livestream.user.first_name.capitalize + " " +@livestream.user.last_name.capitalize.first + "." %></h3>
          </div>

          <div class="col-xs-12 col-sm-8 stats-elements">
              <%= render 'shared/follow_form' %>
              <%= render 'shared/stats' %>
          </div>

          <div class="col-xs-12 col-sm-8">
          <% sum = 0 %>
            <% @user.livestreams.each do |livestream| %>
               <% sum += livestream.tickets_sold %>
            <% end %>
            <p class= "stats-elements"><%= sum %> Total views</p>
          </div>

          <div class="col-xs-12 col-sm-8">
            <p class= "stats-elements"><%= @user.livestreams.count %> Livestreams</p>
          </div>

        <!-- killed the bio -->
          <!-- <div class="row">
          <div class="col-xs-12">
            <div class="profile-about">
              <h3 style= "display: inline; box-sizing: border-box; box-shadow: inset 0px -10px 0px 0px #b7ffd4;">Bio</h3>
              <p><%#= @livestream.user.bio %> </p>
            </div>
          </div>
        </div> -->

          <div class="col-xs-12 profile-about">
            <div class="margin-bottom-20">
              <h3 style= "display: inline; box-sizing: border-box; box-shadow: inset 0px -10px 0px 0px #b7ffd4;">About me</h3>
            </div>

            <h4 class = "margin-left-10" style = "display: inline; box-sizing: border-box; box-shadow: inset 0px -4px 0px 0px #b7ffd4;"><%= @livestream.user.fav1title %></h4>
            <p class = "margin-left-20 margin-bottom-20"> <%= @livestream.user.fav1 %></p>

            <h4 class = "margin-left-10" style = "display: inline; box-sizing: border-box; box-shadow: inset 0px -4px 0px 0px #b7ffd4;"><%= @livestream.user.fav2title %></h4>
            <p class = "margin-left-20 margin-bottom-20"><%= @livestream.user.fav2 %></p>

            <h4 class = "margin-left-10" style = "display: inline; box-sizing: border-box; box-shadow: inset 0px -4px 0px 0px #b7ffd4;"><%= @livestream.user.fav3title %></h4>
            <p class = "margin-left-20"><%= @livestream.user.fav3 %></p>

          </div>

        </div>

        <!-- this is the row for the picture gallery -->
        <div class="row">
          <div class="col-xs-12">
            <div class="black-photo-gallery-wrapper text-center">
              <% @livestream.user.images.each do |photo| %>
              <%= cl_image_tag photo.path, :width=>300 %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-xs-12 col-md-4">
    <br>
      <div class="text-center">
        <h3 style= "display: inline; box-sizing: border-box; box-shadow: inset 0px -10px 0px 0px #b7ffd4;">Upcoming livestreams</h3>
      </div>
      <br>
      <br>
      <!-- <div class="profile-wrapper">
        <p>Sonya's calendar</p>
      </div> -->
      <%#= image_tag "calendar.svg", :class => "small-calendar"%>
      <% @livestreams.each do |livestream| %>
        <div class="profile-wrapper margin-bottom-35">

        <!-- This is start of the card for an upcoming event -->
          <div class="future-livestreams-card">
            <!-- need to put logic here to truncate title if over 58 characters -->
            <h5 class="future-livestreams-card-title"><%= livestream.title %></h5>
            <h6 class="future-livestreams-card-time"> <%= livestream.hour_of_stream.strftime('%A, %b %d %H:%M') %></h6>
            <h6 class="future-livestreams-card-seats"> <%= livestream.tickets_available - (livestream.tickets_sold || 0 )%> seats left </h6>
            <h6 class="future-livestreams-card-ticket-price"><%=  image_tag "rubysmall.svg"%> <%= livestream.ticket_price %></h6>
            <!-- I know u will complain that I didn't put this in a partial but it doesn't work for some reason. Think it's because it's in a loop -->
            <% if current_user == @livestream.user  %>
              <p class="future-livestreams-card-book-button" id="ticket-bought">Good luck!</p>
            <% elsif current_user.tickets.where(livestream: livestream).any? %>
              <p class="future-livestreams-card-book-button" id="ticket-bought">Ticket booked</p>
            <% elsif (livestream.tickets_available - livestream.tickets_sold) == 0 %>
                <p class="future-livestreams-card-book-button" id="tickets-sold-out" >Sold out</p>
            <% else %>
              <%= simple_form_for [livestream, @ticket] do |f| %>
                <%= f.button :submit, 'Book ticket', class: 'future-livestreams-card-book-button btn btn-primary' %>
              <% end %>
            <% end %>
          </div>
        <!-- This is the end of the card for an upcoming event -->
        </div>
      <% end %>
    </div>

    <!-- This is the top fans table -->
    <div class="col-xs-12 col-md-4 text-center">
          <h3 style= "display: inline; box-sizing: border-box; box-shadow: inset 0px -10px 0px 0px #b7ffd4;">Top fans</h3>
      <div class="profile-wrapper">
        <div class="leaderboard">
          <ol class="leaderboard-list">
            <li>
              <mark>Jerry Wood</mark>
              <small> <span><img src="/assets/ruby-1c4db2d54622c936d213665e5137a5444b6b1528e6c9bdaf9994720fc5a0f7f4.svg" alt="Ruby" class = "ruby_fans_img_1"></span> 1924</small>
            </li>
            <li>
              <mark>Brandon Barnes</mark>
              <small> <span><img src="/assets/ruby-1c4db2d54622c936d213665e5137a5444b6b1528e6c9bdaf9994720fc5a0f7f4.svg" alt="Ruby" class = "ruby_fans_img_2"></span> 919</small>
            </li>
            <li>
              <mark>Raymond Knight</mark>
              <small> <span><img src="/assets/ruby-1c4db2d54622c936d213665e5137a5444b6b1528e6c9bdaf9994720fc5a0f7f4.svg" alt="Ruby" class = "ruby_fans_img_2"></span> 450</small>
            </li>
            <li>
              <mark>Trevor McCormick</mark>
              <small> <span><img src="/assets/ruby-1c4db2d54622c936d213665e5137a5444b6b1528e6c9bdaf9994720fc5a0f7f4.svg" alt="Ruby" class = "ruby_fans_img_2"></span> 246</small>
            </li>
            <li>
              <mark>Andrew Fox</mark>
              <small> <span><img src="/assets/ruby-1c4db2d54622c936d213665e5137a5444b6b1528e6c9bdaf9994720fc5a0f7f4.svg" alt="Ruby" class = "ruby_fans_img_2"></span> 139</small>
            </li>
            <li>
              <mark>Jerry Wood</mark>
              <small> <span><img src="/assets/ruby-1c4db2d54622c936d213665e5137a5444b6b1528e6c9bdaf9994720fc5a0f7f4.svg" alt="Ruby" class = "ruby_fans_img_3"></span> 98</small>
            </li>
            <li>
              <mark>Brandon Barnes</mark>
              <small> <span><img src="/assets/ruby-1c4db2d54622c936d213665e5137a5444b6b1528e6c9bdaf9994720fc5a0f7f4.svg" alt="Ruby" class = "ruby_fans_img_3"></span> 96</small>
            </li>
            <li>
              <mark>Raymond Knight</mark>
              <small> <span><img src="/assets/ruby-1c4db2d54622c936d213665e5137a5444b6b1528e6c9bdaf9994720fc5a0f7f4.svg" alt="Ruby" class = "ruby_fans_img_3"></span> 82</small>
            </li>
            <li>
              <mark>Trevor McCormick</mark>
              <small> <span><img src="/assets/ruby-1c4db2d54622c936d213665e5137a5444b6b1528e6c9bdaf9994720fc5a0f7f4.svg" alt="Ruby" class = "ruby_fans_img_3"></span> 75</small>
            </li>
            <li>
              <mark>Andrew Fox</mark>
              <small> <span><img src="/assets/ruby-1c4db2d54622c936d213665e5137a5444b6b1528e6c9bdaf9994720fc5a0f7f4.svg" alt="Ruby" class = "ruby_fans_img_3"></span> 71</small>
            </li>
          </ol>
        </div>
      </div>
    </div>
    <!-- This is the social media follow div -->
    <div class="social-icons-right-side">
      <div class=" text-center margin-bottom-20">
        <h4> Follow <%= @livestream.user.first_name %> on . . .</h4>

        <i style="font-size: 100px; padding-right: 10px;" class="fa fa-facebook-square" aria-hidden="true"></i>
        <i style="font-size: 100px; padding-right: 10px;" class="fa fa-instagram" aria-hidden="true"></i>
        <i style="font-size: 100px; padding-right: 10px;" class="fa fa-snapchat-square" aria-hidden="true"></i>
      </div>

    </div>

  </div>
</div>
</div>


